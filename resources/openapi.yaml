openapi: 3.0.2
info:
  version: 0.0.1
  title: aoide
  description: Music library management service.
  license:
    name: AGPL-3.0-or-later
    url: 'https://www.gnu.org/licenses/agpl-3.0.html'
servers:
  - url: 'http://[::1]:7878/'
    description: Local development server
paths:
  /collections:
    get:
      summary: List collections
      description: |
        List all collections that have recently been created/modified.
      operationId: listCollections
      tags:
        - Collections
      parameters:
        - $ref: '#/components/parameters/paginationOffset'
        - $ref: '#/components/parameters/paginationLimit'
      responses:
        '200':
          description: |
            An array of collection entities sorted in descending order of the
            corresponding time stamp.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CollectionEntity'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '500':
          $ref: '#/components/responses/500InternalServerError'
    post:
      summary: Create a new collection
      operationId: createCollection
      tags:
        - Collections
      requestBody:
        description: |
          Properties of the new collection.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Collection'
      responses:
        '201':
          description: |
            The header of the newly created collection entity.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityHeader'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  '/collections/{collectionUid}':
    get:
      summary: Load a collection
      description: |
        Load a collection entity referenced by its UID.
      operationId: loadCollection
      tags:
        - Collections
      parameters:
        - $ref: '#/components/parameters/collectionUidPath'
        - $ref: '#/components/parameters/withCollectionQuery'
      responses:
        '200':
          description: |
            The loaded collection entity, optionally with additional statistics.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionEntityWithStats'
        '404':
          $ref: '#/components/responses/404NotFound'
        '500':
          $ref: '#/components/responses/500InternalServerError'
    put:
      summary: Update a collection
      description: |
        Update a collection entity after validating that the provided `header`
        matches that of the current entity (optimistic locking).
      operationId: updateCollection
      tags:
        - Collections
      parameters:
        - $ref: '#/components/parameters/collectionUidPath'
      requestBody:
        description: |
          A collection entity with the current `header` and and updated `body`.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionEntity'
      responses:
        '200':
          description: |
            The header of the updated collection entity.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityHeader'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'
        '500':
          $ref: '#/components/responses/500InternalServerError'
    delete:
      summary: Delete a collection
      operationId: deleteCollection
      tags:
        - Collections
      parameters:
        - $ref: '#/components/parameters/collectionUidPath'
      responses:
        '204':
          $ref: '#/components/responses/204NoContent'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  /tracks:
    get:
      summary: List tracks
      description: |
        List all tracks that have either recently been created/modified if no
        collection is specified or that have recently been added to the given
        collection.
      operationId: listTracks
      tags:
        - Tracks
      parameters:
        - $ref: '#/components/parameters/collectionUidParam'
        - $ref: '#/components/parameters/paginationOffset'
        - $ref: '#/components/parameters/paginationLimit'
      responses:
        '200':
          description: |
            An array of track entities sorted in descending order of the
            corresponding time stamp.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TrackEntity'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'
        '500':
          $ref: '#/components/responses/500InternalServerError'
    post:
      summary: Create a new track
      operationId: createTrack
      tags:
        - Tracks
      responses:
        '201':
          description: |
            The header of the newly created track entity.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityHeader'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  '/tracks/{trackUid}':
    get:
      summary: Load a track
      description: |
        Load a track entity referenced by its UID.
      operationId: loadTrack
      tags:
        - Tracks
      parameters:
        - $ref: '#/components/parameters/trackUidPath'
      responses:
        '200':
          description: |
            The loaded track entity.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrackEntity'
        '404':
          $ref: '#/components/responses/404NotFound'
        '500':
          $ref: '#/components/responses/500InternalServerError'
    put:
      summary: Update a track
      description: |
        Update a track entity after validating that the provided `header`
        matches that of the current entity (optimistic locking).
      operationId: updateTrack
      tags:
        - Tracks
      parameters:
        - $ref: '#/components/parameters/trackUidPath'
      requestBody:
        description: |
          A track entity with the current `header` and and updated `body`.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrackEntity'
      responses:
        '200':
          description: |
            The header of the updated track entity.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityHeader'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '404':
          $ref: '#/components/responses/404NotFound'
        '500':
          $ref: '#/components/responses/500InternalServerError'
    delete:
      summary: Delete a track
      operationId: deleteTrack
      tags:
        - Tracks
      parameters:
        - $ref: '#/components/parameters/trackUidPath'
      responses:
        '204':
          $ref: '#/components/responses/204NoContent'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  /tracks/locate:
    post:
      summary: Locate tracks by URI
      description: |
        Locate tracks according to their (percent-encoded) source URI.
        Optionally the URI lookup can be restricted to a single collection.
      operationId: locateTracks
      tags:
        - Tracks
      parameters:
        - $ref: '#/components/parameters/collectionUidParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocateTracksParams'
      responses:
        '200':
          description: |
            An array of matching tracks.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TrackEntity'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  /tracks/replace:
    post:
      summary: Replace tracks by URI
      description: |
        Replace tracks with a new revision by locating them through their
        (percent-encoded) source URI. Optionally the URI lookup can be
        restricted to a single collection.
      operationId: replaceTracks
      tags:
        - Tracks
      parameters:
        - $ref: '#/components/parameters/collectionUidParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReplaceTracksParams'
      responses:
        '200':
          description: |
            An array of matching tracks.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReplacedTracks'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  /tracks/search:
    post:
      summary: Search tracks
      description: |
        Search tracks by evaluating various filter conditions and sort the
        results.
      operationId: searchTracks
      tags:
        - Tracks
      parameters:
        - $ref: '#/components/parameters/collectionUidParam'
        - $ref: '#/components/parameters/paginationOffset'
        - $ref: '#/components/parameters/paginationLimit'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchTracksParams'
      responses:
        '200':
          description: |
            An array of matching tracks in the requested order.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TrackEntity'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  /tracks/tags:
    get:
      summary: List tags
      description: >
        List term frequencies of tag labels for selected (or all) facets.
        Results are

        provided as tags with an average score, listed in descending order of

        their total count. Optionally the evaluation can be restricted to a

        single collection.
      operationId: listTagFrequencies
      tags:
        - Track Tags
      parameters:
        - $ref: '#/components/parameters/collectionUidParam'
        - $ref: '#/components/parameters/tagFacetListQuery'
        - $ref: '#/components/parameters/paginationOffset'
        - $ref: '#/components/parameters/paginationLimit'
      responses:
        '200':
          description: |
            Tag frequencies.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TagCount'
        '500':
          $ref: '#/components/responses/500InternalServerError'
  /tracks/tags/facets:
    get:
      summary: List tag facets
      description: |
        List frequencies for selected (or all) tag facets in descending order of
        their total count. Optionally the evaluation can be restricted to a
        single collection.
      operationId: listTagFacets
      tags:
        - Track Tags
      parameters:
        - $ref: '#/components/parameters/collectionUidParam'
        - $ref: '#/components/parameters/tagFacetListQuery'
        - $ref: '#/components/parameters/paginationOffset'
        - $ref: '#/components/parameters/paginationLimit'
      responses:
        '200':
          description: |
            Tag facet frequencies.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FacetCount'
        '500':
          $ref: '#/components/responses/500InternalServerError'
components:
  responses:
    201Created:
      description: |
        The resource has been created.
    204NoContent:
      description: |
        The request has been processed, no response available.
    400BadRequest:
      description: |
        The request with the provided parameters was invalid.
    404NotFound:
      description: |
        The specified resource was not found.
    500InternalServerError:
      description: |
        The server failed to process the request.
  parameters:
    paginationOffset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        format: int64
        minimum: 0
      description: |
        Number of items to skip before returning the results or 0 if missing.
    paginationLimit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        format: int64
        minimum: 0
      description: >
        Maximum number of items to return or unlimited if missing. When this
        parameter

        is specified its value is evaluated and applied, i.e. a value of 0 will
        result

        in an empty set of returned items.
    collectionUidParam:
      name: collection
      in: query
      required: false
      schema:
        $ref: '#/components/schemas/EntityUid'
      description: |
        An optional UID for selecting a single collection or none for all
        collections.
    collectionUidPath:
      name: collectionUid
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/EntityUid'
      description: |
        The UID of the collection.
    trackUidPath:
      name: trackUid
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/EntityUid'
      description: |
        The UID of the track.
    withCollectionQuery:
      name: with
      in: query
      required: false
      schema:
        type: string
      description: |
        Comma-separated list of boolean options:
          * `track-stats` - Include track statistics
    tagFacetListQuery:
      name: facets
      in: query
      required: false
      schema:
        type: string
      example: ',genre,mood'
      description: |
        Comma-separated list of case-insensitive strings for selecting a subset
        of tags by any of the given facets (alternation). An empty list or a
        list containing an empty item (= leading/trainling comma or 2 subsequent
        commas) selects all tags without a facet (= null). If this parameter is
        missing all tags are selected.
  schemas:
    Actor:
      properties:
        name:
          type: string
          minLength: 1
        role:
          $ref: '#/components/schemas/ActorRole'
        precedence:
          $ref: '#/components/schemas/ActorPrecedence'
      required:
        - name
      description: |
        Some actor naming examples:
          * summary = 'Michael Jackson'
          * summary = 'Bill Medley & Jennifer Warnes', primary = 'Bill Medley', primary = 'Jennifer Warnes'
          * summary = 'Nick Jonas ft. Anne-Marie & Mike Posner', primary = 'Nick Jonas', secondary = 'Anne-Marie', secondary = 'Mike Posner'
    ActorPrecedence:
      type: string
      enum:
        - summary
        - primary
        - secondary
      description: |
        Optional precedence that defaults to `summary` if missing:
          * `summary` - the default display string
          * `primary` - primary actor(s)
          * `secondary` - secondary actor(s)
    ActorRole:
      type: string
      enum:
        - artist
        - arranger
        - composer
        - conductor
        - djmixer
        - engineer
        - lyricist
        - mixer
        - performer
        - producer
        - publisher
        - remixer
        - writer
      description: |
        Optional role that defaults to `artist` if missing
    Album:
      properties:
        titles:
          type: array
          items:
            $ref: '#/components/schemas/Title'
        actors:
          type: array
          items:
            $ref: '#/components/schemas/Actor'
        compilation:
          type: boolean
          description: |
            Indicates whether this album is a compilation with various artists.
    AudioContent:
      properties:
        channelCount:
          $ref: '#/components/schemas/ChannelCount'
        duration:
          $ref: '#/components/schemas/DurationMs'
        sampleRate:
          $ref: '#/components/schemas/SampleRateHz'
        bitRate:
          $ref: '#/components/schemas/BitRateBps'
        loudness:
          $ref: '#/components/schemas/LoudnessLufs'
        encoder:
          $ref: '#/components/schemas/Encoder'
    BitRateBps:
      type: integer
      format: int32
      minimum: 0
      example: 256000
      description: |
        The bit rate in bits per second (bps).
    ChannelCount:
      type: integer
      minimum: 0
      maximum: 65535
      example: 2
    Collection:
      properties:
        name:
          type: string
        desc:
          type: string
      required:
        - name
    CollectionStats:
      properties:
        tracks:
          $ref: '#/components/schemas/CollectionTrackStats'
    CollectionTrackStats:
      properties:
        totalCount:
          $ref: '#/components/schemas/TotalCount'
      required:
        - totalCount
    CollectionEntity:
      properties:
        hdr:
          $ref: '#/components/schemas/EntityHeader'
        body:
          $ref: '#/components/schemas/Collection'
      required:
        - header
        - body
    CollectionEntityWithStats:
      properties:
        hdr:
          $ref: '#/components/schemas/EntityHeader'
        body:
          $ref: '#/components/schemas/Collection'
        stats:
          $ref: '#/components/schemas/CollectionStats'
      required:
        - hdr
        - body
    Color:
      type: string
      minLength: 9
      maxLength: 9
      example: '#FF808080'
      description: |
        A hexadecimal color code `#AARRGGBB` with 8 bits per channel.
    ConditionModifier:
      type: string
      enum:
        - not
    DurationMs:
      type: number
      minimum: 0
      example: 210387.576
    PositionMs:
      type: number
      example: 210387.576
    Encoder:
      properties:
        name:
          type: string
        settings:
          type: string
    EntityUid:
      type: string
      minLength: 32
      maxLength: 33
      example: 4L9v84JeigpHxEdtVHUkL6JASD92sDwdW
      description: A globally unique identifier (UID) for entities in base-58 encoding.
    EntityRevisionOrdinal:
      type: integer
      format: int64
      minimum: 1
      example: 3
    EntityRevisionTimeStamp:
      type: integer
      format: int64
      example: 1552823952261838
    EntityRevision:
      type: array
      minItems: 2
      maxItems: 2
      items:
        oneOf:
          - $ref: '#/components/schemas/EntityRevisionOrdinal'
          - $ref: '#/components/schemas/EntityRevisionTimeStamp'
      description: |
        Tuple of 2 elements containing an ordinal and a timestamp.
    EntityHeader:
      properties:
        uid:
          $ref: '#/components/schemas/EntityUid'
        rev:
          $ref: '#/components/schemas/EntityRevision'
    FilterModifier:
      type: string
      enum:
        - complement
    IndexCount:
      type: array
      minItems: 2
      maxItems: 2
      items:
        type: integer
        format: int32
        minimum: 0
      description: >
        Identifies the number of the current item and the number of total items.
        Both values are optional and might be `null`.
    KeyCode:
      type: integer
      minimum: 0
      maximum: 24
      example: 1
      description: |
        The key signature is denoted by a code with one of the following values:
          * 0 = unknown/invalid
          * 1 = C maj
          * 2 = A min
          * 3 = G maj
          * 4 = E min
          * ...
          * 23 = F maj
          * 24 = D min
    LanguageCode:
      type: string
      minLength: 2
      maxLength: 3
      example: eng
      description: |
        A language code according to ISO 639-1/2/3.
    UriFilter:
      properties:
        modifier:
          $ref: '#/components/schemas/FilterModifier'
        condition:
          $ref: '#/components/schemas/StringCondition'
      required:
        - condition
    LocateTracksParams:
      properties:
        uri:
          $ref: '#/components/schemas/UriFilter'
    LoudnessLufs:
      type: number
      example: -13.4239
      description: >
        Loudness is measured in "Loudness Units relative to Full Scale" (LUFS)
        with 1 LU = 1 dB according to ITU-R BS.1770. EBU R128 proposes a target
        level of -23 LUFS while the ReplayGain v2 specification (RG2) proposes
        -18 LUFS for achieving similar perceptive results compared to ReplayGain
        v1 (RG1).
    MediaType:
      type: string
      minLength: 1
      example: audio/mpeg
      description: |
        A media type string according to RFC 6838.
    NumericComparator:
      type: string
      enum:
        - less-than
        - greater-than
        - equal-to
      description: |
        Numeric comparison operators.
    NumericPredicateLessThan:
      properties:
        lt:
          type: number
      required:
        - lt
    NumericPredicateLessOrEqual:
      properties:
        le:
          type: number
      required:
        - le
    NumericPredicateGreaterThan:
      properties:
        gt:
          type: number
      required:
        - gt
    NumericPredicateGreaterOrEqual:
      properties:
        ge:
          type: number
      required:
        - ge
    NumericPredicateEqual:
      properties:
        eq:
          type: number
    NumericPredicateNotEqual:
      properties:
        ne:
          type: number
    NumericPredicate:
      oneOf:
        - $ref: '#/components/schemas/NumericPredicateLessThan'
        - $ref: '#/components/schemas/NumericPredicateLessOrEqual'
        - $ref: '#/components/schemas/NumericPredicateGreaterThan'
        - $ref: '#/components/schemas/NumericPredicateGreaterOrEqual'
        - $ref: '#/components/schemas/NumericPredicateEqual'
        - $ref: '#/components/schemas/NumericPredicateNotEqual'
    NumericField:
      type: string
      enum:
        - releaseYear
        - bitRate
        - channelCount
        - duration
        - loudness
        - sampleRate
        - musicTempo
        - musicKey
    NumericFilter:
      properties:
        field:
          $ref: '#/components/schemas/NumericField'
        value:
          $ref: '#/components/schemas/NumericPredicate'
      required:
        - field
        - value
    PhraseFilter:
      properties:
        fields:
          type: array
          items:
            $ref: '#/components/schemas/StringField'
        text:
          type: string
          example: michael jackson
          description: >
            Tokenized by whitespace, concatenated with wildcards, and filtered
            using case-insensitive "contains" semantics against each of the
            selected fields, e.g. "la bell" or "tt ll" both match "Patti
            LaBelle". An empty string matches both empty and missing/null
            fields.
      required:
        - fields
        - text
      description: |
        Filters for a given phrase in any of the enumerated string fields.
        A match for at least one of the fields is sufficient.
    Release:
      properties:
        copyright:
          type: string
        licenses:
          type: array
          items:
            type: string
        releasedAt:
          $ref: '#/components/schemas/TimeStamp'
        releasedBy:
          type: string
    ReplacementMode:
      type: string
      enum:
        - update-only
        - update-or-create
      description: |
        Operational mode for resolving conflicts during replacement
          * `update-only` - only update existing entities and discard new entities that need to be created
          * `update-or-create` - create a new entity if no existing entity could be found/located
    ReplaceTracksParams:
      properties:
        mode:
          $ref: '#/components/schemas/ReplacementMode'
        replacements:
          type: array
          items:
            $ref: '#/components/schemas/TrackReplacement'
    ReplacedTracks:
      properties:
        created:
          type: array
          items:
            $ref: '#/components/schemas/EntityHeader'
        updated:
          type: array
          items:
            $ref: '#/components/schemas/EntityHeader'
        skipped:
          description: |
            Unchanged tracks that don't need to be updated.
          type: array
          items:
            $ref: '#/components/schemas/EntityHeader'
        rejected:
          description: |
            Informational messages about ambiguous or inconsistent tracks.
          type: array
          items:
            type: string
        discarded:
          description: |
            Informational messages about nonexistent tracks that need to be
            created.
          type: array
          items:
            type: string
    SampleRateHz:
      type: integer
      format: int32
      minimum: 0
      example: 44100
      description: |
        The sample rate in Hertz (Hz).
    Tag:
      type: array
      minLength: 2
      maxLength: 2
      items:
        oneOf:
          - $ref: '#/components/schemas/TagLabel'
          - $ref: '#/components/schemas/ScoreValue'
      description: |
        Tuple of 2 elements containing a label and a score.
    FacetedTag:
      type: array
      minLength: 3
      maxLength: 3
      items:
        oneOf:
          - $ref: '#/components/schemas/TagFacet'
          - $ref: '#/components/schemas/TagLabel'
          - $ref: '#/components/schemas/ScoreValue'
      description: |
        Tuple of 3 elements containing a facet, a label, and a score value.
    TagCount:
      properties:
        tag:
          $ref: '#/components/schemas/Tag'
        count:
          $ref: '#/components/schemas/TotalCount'
      required:
        - tag
        - count
      description: >
        Tag with an average score across all occurrences and the total number of
        occurrences.
    ScoreValue:
      type: number
      minimum: 0
      maximum: 1
      example: 0.83
      description: |
        Normalized score value between 0 and 1.
    TrackSearchFilterNode:
      oneOf:
        - $ref: '#/components/schemas/TrackSearchPhraseFilterNode'
        - $ref: '#/components/schemas/TrackSearchNumericFilterNode'
        - $ref: '#/components/schemas/TrackSearchTagFilterNode'
        - $ref: '#/components/schemas/TrackSearchAllFilterNode'
        - $ref: '#/components/schemas/TrackSearchAnyFilterNode'
        - $ref: '#/components/schemas/TrackSearchNotFilterNode'
      discriminator:
        propertyName: type
      required:
        - type
    TrackSearchPhraseFilterNode:
      properties:
        type:
          type: string
        filter:
          $ref: '#/components/schemas/PhraseFilter'
      required:
        - type
    TrackSearchNumericFilterNode:
      properties:
        type:
          type: string
        filter:
          $ref: '#/components/schemas/NumericFilter'
    TrackSearchTagFilterNode:
      properties:
        type:
          type: string
        filter:
          $ref: '#/components/schemas/TagFilter'
      required:
        - type
    TrackSearchAllFilterNode:
      properties:
        type:
          type: string
        filter:
          type: array
          items:
            $ref: '#/components/schemas/TrackSearchFilterNode'
      required:
        - type
    TrackSearchAnyFilterNode:
      properties:
        type:
          type: string
        filter:
          type: array
          items:
            $ref: '#/components/schemas/TrackSearchFilterNode'
      required:
        - type
    TrackSearchNotFilterNode:
      properties:
        type:
          type: string
        filter:
          $ref: '#/components/schemas/TrackSearchFilterNode'
      required:
        - type
        - filter
    SearchTracksParams:
      properties:
        filter:
          $ref: '#/components/schemas/TrackSearchFilterNode'
        ordering:
          type: array
          items:
            $ref: '#/components/schemas/TrackSortOrder'
    TrackMusic:
      properties:
        tempo:
          $ref: '#/components/schemas/TempoBpm'
        key:
          $ref: '#/components/schemas/KeyCode'
        timing:
          $ref: '#/components/schemas/TimeSignature'
    SortDirection:
      type: string
      enum:
        - asc
        - dsc
      description: |
        Direction for sorting results.
          * `asc` - ascending
          * `dsc` - descending
    StringMatcher:
      oneOf:
        - $ref: '#/components/schemas/StringMatcherStartsWith'
        - $ref: '#/components/schemas/StringMatcherEndsWith'
        - $ref: '#/components/schemas/StringMatcherContains'
        - $ref: '#/components/schemas/StringMatcherMatches'
        - $ref: '#/components/schemas/StringMatcherEquals'
    StringMatcherStartsWith:
      properties:
        startsWith:
          type: string
      description: Matches the head of a string (case-insensitive)
    StringMatcherEndsWith:
      properties:
        endsWith:
          type: string
      description: Matches the tail of a string (case-insensitive)
    StringMatcherContains:
      properties:
        contains:
          type: string
      description: Matches the middle of the string with arbitrary head/tail (case-insensitive)
    StringMatcherMatches:
      properties:
        matches:
          type: string
      description: Matches the whole string (case-insensitive)
    StringMatcherEquals:
      properties:
        equals:
          type: string
      description: Exact match (case-sensitive)
    StringCondition:
      properties:
        modifier:
          $ref: '#/components/schemas/ConditionModifier'
        matcher:
          $ref: '#/components/schemas/StringMatcher'
      required:
        - matcher
    StringTotalCount:
      properties:
        value:
          type: string
        count:
          $ref: '#/components/schemas/TotalCount'
      required:
        - value
        - count
    StringField:
      type: string
      enum:
        - sourceUri
        - contentType
        - trackTitle
        - trackArtist
        - trackComposer
        - albumTitle
        - albumArtist
      description: |
        Selectable fields, including
          * `uri` - percent-decoded URI
          * `contentType` - media (MIME) type
          * ...
    StringFieldCount:
      properties:
        field:
          $ref: '#/components/schemas/StringField'
        counts:
          type: array
          items:
            $ref: '#/components/schemas/StringTotalCount'
      required:
        - field
        - counts
    TagFacet:
      type: string
      minLength: 1
      example: genre
      description: |
        Non-empty, lowercase, string that defines the (optional) facet of tag.
    FacetCount:
      properties:
        facet:
          $ref: '#/components/schemas/TagFacet'
        count:
          $ref: '#/components/schemas/TotalCount'
      required:
        - count
      description: |
        Optional tag facet with the total number of occurrences.
    TagFilter:
      properties:
        modifier:
          $ref: '#/components/schemas/FilterModifier'
        facet:
          $ref: '#/components/schemas/TagFacet'
        label:
          $ref: '#/components/schemas/StringCondition'
        score:
          $ref: '#/components/schemas/NumericPredicate'
    TagLabel:
      type: string
      minLength: 1
      example: Hip Hop/Rap
      description: |
        Non-empty string that defines the textual content of the tag.
    TempoBpm:
      type: number
      minimum: 0
      example: 110.67
      description: |
        The tempo measured in `beats per minute` (bpm).
    TimeSignature:
      type: array
      minLength: 2
      maxLength: 2
      items:
        oneOf:
          - $ref: '#/components/schemas/TimeSignatureTop'
          - $ref: '#/components/schemas/TimeSignatureBottom'
      description: >
        Tuple of 2 elements containing the top and bottom values of the time
        signature.
    TimeSignatureTop:
      type: integer
      minimum: 0
      maximum: 65535
      example: 3
      description: >
        The top number of the time signature that denotes the number of beats in
        each measure or bar.
    TimeSignatureBottom:
      type: integer
      minimum: 0
      maximum: 65535
      example: 4
      description: >
        The bottom number of the time signature that denotes which type of note
        is getting the beat.
    TimeStamp:
      type: string
      format: date-time
      example: '2018-06-10T12:19:50.758Z'
    Title:
      properties:
        name:
          type: string
          minLength: 1
          example: Yellow Submarine
        level:
          $ref: '#/components/schemas/TitleLevel'
        lang:
          $ref: '#/components/schemas/LanguageCode'
      required:
        - name
    TitleLevel:
      type: string
      enum:
        - main
        - sub
        - wrk
        - mvn
      description: |
        Optional level that defaults to `main` if missing
          * `main` - default display string
          * `sub` - a subtitle
          * `wrk` - a work title for classical music
          * `mvn` - a movement title for classical music
    TotalCount:
      type: integer
      format: int64
      minimum: 0
      example: 1746
      description: |
        Total number of occurrences.
    Track:
      properties:
        collections:
          type: array
          items:
            $ref: '#/components/schemas/TrackCollection'
        sources:
          type: array
          items:
            $ref: '#/components/schemas/TrackSource'
        titles:
          type: array
          items:
            $ref: '#/components/schemas/Title'
        actors:
          type: array
          items:
            $ref: '#/components/schemas/Actor'
        album:
          $ref: '#/components/schemas/Album'
        release:
          $ref: '#/components/schemas/Release'
        discNumbers:
          $ref: '#/components/schemas/IndexCount'
        trackNumbers:
          $ref: '#/components/schemas/IndexCount'
        movementNumbers:
          $ref: '#/components/schemas/IndexCount'
        music:
          $ref: '#/components/schemas/TrackMusic'
        markers:
          type: array
          items:
            $ref: '#/components/schemas/TrackMarker'
        locks:
          type: array
          items:
            $ref: '#/components/schemas/TrackLock'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        ftags:
          type: array
          items:
            $ref: '#/components/schemas/FacetedTag'
    TrackCollection:
      properties:
        uid:
          $ref: '#/components/schemas/EntityUid'
        since:
          $ref: '#/components/schemas/TimeStamp'
        color:
          $ref: '#/components/schemas/Color'
        playCount:
          type: integer
          format: int64
          minimum: 0
      required:
        - uid
        - since
    TrackEntity:
      properties:
        hdr:
          $ref: '#/components/schemas/EntityHeader'
        body:
          $ref: '#/components/schemas/Track'
      required:
        - header
        - body
    TrackLock:
      type: string
      enum:
        - loudness
        - tempo
        - key
        - timing
    TrackMark:
      type: string
      enum:
        - load-cue
        - hot-cue
        - intro
        - outro
        - loop
        - sample
      description: >
        * `load-cue` - default start point when loading a track, only one per
        track

        * `hot-cue` - jump point

        * `intro` - only one per track

        * `outro` - only one per track

        * `loop`

        * `sample`
    TrackMarker:
      properties:
        mark:
          $ref: '#/components/schemas/TrackMark'
        start:
          $ref: '#/components/schemas/PositionMs'
        end:
          $ref: '#/components/schemas/PositionMs'
        number:
          type: integer
          format: int32
        label:
          type: string
        color:
          $ref: '#/components/schemas/Color'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        ftags:
          type: array
          items:
            $ref: '#/components/schemas/FacetedTag'
      required:
        - mark
      description: >
        Marker to identify points (either start or end) or sections (both start
        and end) within a track
    TrackReplacement:
      properties:
        uri:
          $ref: '#/components/schemas/Uri'
        track:
          $ref: '#/components/schemas/Track'
      required:
        - uri
        - track
      description: |
        The URI is used for looking up the existing track (if any) that gets
        replaced.
    TrackSortField:
      type: string
      enum:
        - inCollectionSince
        - lastRevisionedAt
        - trackTitle
        - trackArtist
        - albumTitle
        - albumArtist
        - releaseYear
        - musicTempo
    TrackSortOrder:
      properties:
        field:
          $ref: '#/components/schemas/TrackSortField'
        direction:
          $ref: '#/components/schemas/SortDirection'
    TrackSource:
      properties:
        uri:
          $ref: '#/components/schemas/Uri'
        contentType:
          $ref: '#/components/schemas/MediaType'
        audioContent:
          $ref: '#/components/schemas/AudioContent'
    Uri:
      type: string
      minLength: 1
      example: >-
        file:///home/user/Music/album%20artist/album%20title/01%20the%20first%20track.mp3
      description: |
        A percent-encoded URI.
